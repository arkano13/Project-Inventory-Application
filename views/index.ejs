<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/indexStyle.css">
</head>
<body>

<% if (locals.error) { %>
  <p style="color: red;"><%= error %></p>
<% } %>

    <nav>
        <a href="/" class="nav-brand">üìö Biblioteca</a>
        <ul class="nav-links">
            <li><a href="/createAuthors">Autores</a></li>
            <li><a href="/createPublishers">Editoriales</a></li>
            <li><a href="/booksList">Crear Libro</a></li>
            <li><a href="/createCategories">Categor√≠as</a></li>
        </ul>
    </nav>

    <div class="hero">
        <p class="hero-label">Cat√°logo</p>
        <h1>Tu <span>Biblioteca</span><br>Personal</h1>
        <p class="hero-sub"><%= books.length %> libro<%= books.length !== 1 ? 's' : '' %> en la colecci√≥n</p>
    </div>

    <hr class="divider">

    <div class="search-bar-wrap">
        <input type="text" id="searchBooks" placeholder="Buscar por t√≠tulo, autor, editorial..." oninput="filterBooks()">
    </div>

    <div class="books-grid" id="booksGrid">
        <% if (books.length === 0) { %>
            <div class="empty">
                <div class="empty-icon">üìñ</div>
                <h2>Sin libros a√∫n</h2>
                <p>Empieza agregando tu primer libro a la colecci√≥n.</p>
                <a href="/booksList">Agregar libro</a>
            </div>
        <% } else { %>
            <% books.forEach((book, i) => { %>
                <div class="book-card" data-search="<%= (book.book_name + ' ' + book.authors + ' ' + book.publisher_name).toLowerCase() %>">
                    <div class="book-number">N¬∫ <%= String(i + 1).padStart(2, '0') %></div>
                    <div class="book-title"><%= book.book_name %></div>
                    <div class="book-meta">
                        <div class="meta-row">
                            <span class="meta-label">Autor</span>
                            <span class="meta-value accent"><%= book.authors %></span>
                        </div>
                        <div class="meta-row">
                            <span class="meta-label">Editorial</span>
                            <span class="meta-value"><%= book.publisher_name %></span>
                        </div>
                        <div class="meta-row">
                            <span class="meta-label">A√±o</span>
                            <span class="meta-value"><%= book.release_year || 'N/A' %></span>
                        </div>
                    </div>
                    <% if (book.categories) { %>
                        <div class="tags">
                            <% book.categories.split(', ').forEach(cat => { %>
                                <span class="tag"><%= cat.trim() %></span>
                            <% }) %>
                        </div>
                    <% } %>
                    <div class="card-actions">
              <a href="/<%= book.book_id %>/edit" class="btn-edit">‚úèÔ∏è Editar</a>

         <form id="delete-<%= book.book_id %>" action="/<%= book.book_id %>/delete" method="POST">
      <button type="button" onclick="confirmarAccion('delete-<%= book.book_id %>', '<%= book.book_id %>')" class="btn-delete">üóë Borrar</button>
        </form>
                    </div>
                </div>
            <% }) %>
        <% } %>
    </div>

    <script>
        function filterBooks() {
            const query = document.getElementById('searchBooks').value.toLowerCase();
            document.querySelectorAll('.book-card').forEach(card => {
                const text = card.dataset.search || '';
                card.style.display = text.includes(query) ? '' : 'none';
            });
        }

async function confirmarAccion(formId, bookId) {
  const password = prompt("Ingresa la contrase√±a de administrador:");
  if (password === null) return;

  const response = await fetch(`/${bookId}/delete`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ password })
  });

  if (response.ok) {
    window.location.href = "/";
  } else {
    alert("Contrase√±a incorrecta ‚ùå");
  }
}

    </script>

</body>
</html>